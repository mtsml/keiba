## フォルダ構成
```
./
├─ db/        # DB
├─ scrape/    # スクレイピング
└─ model/     # 予想
```

## scrapying
scrape.utilの関数を使ってスクレイピングします。

すぐに利用できるスクリプトが2つ用意されています。ただし、これらを利用するためには、DBのセットアップと環境変数への接続情報の追加が必要です。

### scrape.scrape_race_1year
任意の年の任意のレースについて、下記のデータをDBに保存します。

- 検索対象のレースの情報 -> raceテーブル
- 検索対象のレースの競争結果 -> race_horse_mapテーブル
- 検索対象のレースに出走した馬の情報 -> horseテーブル
- 検索対象のレースに出走した馬の過去の競争結果 -> race, race_horse_mapテーブル

1995年の宝塚記念のデータを取得するサンプルです。

```sh
$ python scrape/scrape_race_1year.py
検索ワードを入力してください >宝塚記念
年度を入力してください      >1995
len:  1
race_id:  199508010810
race_name:  第36回宝塚記念(G1)
  horse_id:  1990109145
  horse_name:  ○外ダンツシアトル
    past_race_id:  199508050711
    past_race_name:  第40回京阪杯(G3)
```

処理が完了するとエラー情報が出力されます。[^1]

```sh
  horse_id:  2005101851
  horse_name:  レッツゴーキリシマ
  過去レース登録済みのためスキップ
------------------------------------------
おわったよ。
Error race_id_list:  []
Error horse_id_list:  ['2007103594', '2006101906', '2006101091']
```

また、メッセージにあるように、既にDBに登録済みの馬は処理をスキップします。

[^1]:サンプルが2012年のエプソムカップに変わっています。

### scrape.scrape_horse
任意の馬のデータをDBに保存します。

- 検索対象の馬の情報 -> horse
- 検索対象の馬の過去の競争結果 -> race, race_horse_mapテーブル

レディアルバローザのデータを取得するサンプルです。

```sh
$ python scrape/scrape_horse.py 
馬のIDを入力してください >2007103594
horse_name:  レディアルバローザ
  past_race_id:  201308010611
  past_race_name:  第48回京都牝馬ステークス(G3)
```

処理が完了するとエラー情報が出力されます。

```sh
------------------------------------------
おわったよ。
Error race_id_list:  []
```